<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Invent√°rio ‚Äî A √öltima Dose</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="config.js"></script>
<script>
    // Sistema de Senha por Ficha
    const SENHAS_FICHAS = {
        'Josue': 'pantufa',
        'Trinity': 'trinity123'
    };

    function verificarAutenticacao() {
        const authData = localStorage.getItem('fichaAuth');
        if (authData) {
            try {
                const auth = JSON.parse(authData);
                if (auth.nome === NOME_PERSONAGEM && (Date.now() - auth.timestamp) < 86400000) {
                    liberarAcesso();
                    return;
                }
            } catch(e) {}
        }
    }

    function verificarSenha() {
        const inputSenha = document.getElementById('password-input').value;
        const senhaCorreta = SENHAS_FICHAS[NOME_PERSONAGEM];

        if (!senhaCorreta || inputSenha === senhaCorreta) {
            localStorage.setItem('fichaAuth', JSON.stringify({
                nome: NOME_PERSONAGEM,
                timestamp: Date.now()
            }));
            liberarAcesso();
        } else {
            document.getElementById('password-error').style.display = 'block';
            document.getElementById('password-input').value = '';
            document.getElementById('password-input').focus();
        }
    }

    function liberarAcesso() {
        document.body.classList.remove('locked');
        const screen = document.getElementById('password-screen');
        if (screen) screen.remove();
    }

    if (typeof NOME_PERSONAGEM !== 'undefined') {
        verificarAutenticacao();
    }
</script>

<link href="https://fonts.googleapis.com/css2?family=Rye&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">

<style>
:root {
    --ink: #2b1b12;
    --cell-bg: rgba(200, 210, 230, 0.85);
    --header-bg: #1a1a1a;
    --gold: #ffcc80;
}

/* TELA DE SENHA */
.password-screen {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: url('assets/fundosenha.jpg') center/cover no-repeat;
    display: flex; justify-content: center; align-items: center;
    z-index: 9999;
}
.password-screen::before {
    content: '';
    position: absolute;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.7);
}
.password-box {
    position: relative;
    background: linear-gradient(135deg, #3b2e22, #2a1f18);
    border: 4px solid #5d4037;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    box-shadow: 0 10px 40px rgba(0,0,0,0.8), inset 0 0 20px rgba(0,0,0,0.5);
    max-width: 350px;
    width: 90%;
}
.password-box h2 {
    font-family: 'Rye', serif;
    color: var(--gold);
    margin: 0 0 10px 0;
    text-shadow: 2px 2px 0 #000;
}
.password-box p {
    color: #aaa;
    margin: 0 0 25px 0;
    font-size: 0.9rem;
}
.password-box input {
    width: 100%;
    padding: 12px;
    font-size: 1rem;
    font-family: 'Courier Prime', monospace;
    background: #1a1411;
    border: 2px solid #5d4037;
    border-radius: 6px;
    color: #e6dccf;
    text-align: center;
    margin-bottom: 15px;
    box-sizing: border-box;
}
.password-box input:focus {
    outline: none;
    border-color: var(--gold);
}
.password-box button {
    width: 100%;
    padding: 12px;
    font-family: 'Rye', serif;
    font-size: 1rem;
    background: linear-gradient(180deg, #5d4037, #3e2723);
    border: 2px solid #8d6e63;
    border-radius: 6px;
    color: var(--gold);
    cursor: pointer;
    text-transform: uppercase;
    transition: 0.2s;
}
.password-box button:hover {
    background: linear-gradient(180deg, #6d4c41, #4e342e);
    box-shadow: 0 0 15px rgba(255,204,128,0.3);
}
.password-error {
    color: #ff6b6b;
    font-size: 0.85rem;
    margin-top: 10px;
    display: none;
}
body.locked > *:not(.password-screen) {
    display: none !important;
}

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    padding: 0;
    min-height: 100vh;
    font-family: 'Courier Prime', monospace;
    position: relative;
    background: #1a1411;
}

/* ===== MENU DE NAVEGA√á√ÉO ===== */
.western-nav {
    display: flex;
    justify-content: center;
    gap: 15px;
    padding: 15px;
    background: rgba(43, 27, 18, 0.95);
    border-bottom: 2px solid #5d4037;
    width: 100%;
    position: sticky;
    top: 0;
    z-index: 100;
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
}

.western-nav a {
    color: #aaa;
    text-decoration: none;
    font-family: 'Rye', serif;
    font-size: 1rem;
    padding: 5px 10px;
    border: 1px solid transparent;
    transition: all 0.2s;
    text-transform: uppercase;
}

.western-nav a:hover {
    color: var(--gold);
    border-color: var(--gold);
}

.western-nav a.active {
    color: var(--gold);
    border-bottom: 2px solid var(--gold);
}

/* Background escurecido */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url("assets/inventario/backgroundinv.png") no-repeat center;
    background-size: cover;
    filter: brightness(0.7);
    z-index: -1;
}

/* Container principal */
.inventory-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px 20px;
    min-height: 100vh;
}

/* Layout principal com tabela e painel lateral */
.inventory-layout {
    display: flex;
    gap: 15px;
    align-items: flex-start;
    justify-content: flex-end;
    width: 100%;
    max-width: 1000px;
    margin-right: 5%;
}

.tables-column {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
    max-width: 750px;
}

/* Painel lateral de espa√ßo */
.space-panel {
    background: rgba(0, 0, 0, 0.5);
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    min-width: 130px;
    position: sticky;
    top: 40px;
}

.space-panel h3 {
    font-family: 'Rye', serif;
    color: #e6dccf;
    font-size: 1.2rem;
    margin: 0 0 15px 0;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.space-display {
    font-family: 'Rye', serif;
    font-size: 2.5rem;
    color: #e6dccf;
    margin: 10px 0;
}

.space-display.over {
    color: #ff4444;
}

.space-label {
    font-family: 'Courier Prime', monospace;
    color: #aaa;
    font-size: 0.9rem;
}

.space-max {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-top: 15px;
}

.space-max label {
    font-family: 'Courier Prime', monospace;
    color: #e6dccf;
    font-size: 0.9rem;
}

.space-max input {
    width: 50px;
    padding: 5px;
    border: 2px solid #5d4037;
    background: rgba(255, 250, 240, 0.9);
    font-family: 'Rye', serif;
    font-size: 1.2rem;
    text-align: center;
    color: var(--ink);
    border-radius: 5px;
}

/* Tabela base */
.inventory-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 4px;
    background: rgba(0, 0, 0, 0.5);
    padding: 15px;
    border-radius: 10px;
}

/* Cabe√ßalhos das se√ß√µes */
.section-header {
    font-family: 'Rye', serif;
    font-size: 1.8rem;
    color: #fff;
    text-transform: uppercase;
    background: var(--header-bg);
    padding: 10px 15px;
    text-shadow: 2px 2px 0 #000, -1px -1px 0 #000;
    letter-spacing: 2px;
}

.section-header.small {
    font-size: 1.2rem;
    text-align: center;
    padding: 8px 10px;
}

/* C√©lulas */
.inventory-table td {
    background: rgba(200, 210, 230, 0.7);
    padding: 12px 15px;
    border: 2px solid #1a1a1a;
}

.inventory-table input {
    width: 100%;
    background: transparent;
    border: none;
    font-family: 'Courier Prime', monospace;
    font-size: 1.1rem;
    color: var(--ink);
    outline: none;
}

.inventory-table input::placeholder {
    color: rgba(43, 27, 18, 0.5);
    font-style: italic;
}

/* Coluna de espa√ßo (itens) */
.col-espaco {
    width: 80px;
    text-align: center;
}

.col-espaco input {
    text-align: center;
    font-weight: bold;
}

/* Colunas armas */
.col-arma-espaco,
.col-arma-dano {
    width: 80px;
    text-align: center;
}

.col-arma-espaco input,
.col-arma-dano input {
    text-align: center;
    font-weight: bold;
}

/* Bot√£o expandir descri√ß√£o */
.col-expand {
    width: 40px;
    text-align: center;
    padding: 5px !important;
}

.btn-expand {
    background: rgba(93, 64, 55, 0.8);
    border: none;
    color: #e6dccf;
    font-size: 1.2rem;
    width: 30px;
    height: 30px;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
}

.btn-expand:hover {
    background: rgba(93, 64, 55, 1);
    transform: scale(1.1);
}

.btn-expand.expanded {
    background: #8b0000;
}

/* Linha de descri√ß√£o */
.item-row {
    position: relative;
}

.desc-row {
    display: none;
}

.desc-row.show {
    display: table-row;
}

.desc-row td {
    background: rgba(255, 250, 240, 0.9) !important;
    padding: 10px 15px !important;
}

.desc-row textarea {
    width: 100%;
    min-height: 60px;
    padding: 10px;
    font-family: 'Courier Prime', monospace;
    font-size: 1rem;
    color: var(--ink);
    background: transparent;
    border: 1px dashed rgba(43, 27, 18, 0.3);
    border-radius: 5px;
    resize: vertical;
    outline: none;
}

.desc-row textarea::placeholder {
    color: rgba(43, 27, 18, 0.5);
    font-style: italic;
}

.desc-row textarea:focus {
    border-color: #5d4037;
}

/* =========================================
   RESPONSIVIDADE MOBILE
   ========================================= */

/* Tablets e telas m√©dias */
@media (max-width: 1024px) {
    .inventory-layout {
        flex-direction: column;
        align-items: center;
        margin-right: 0;
    }
    
    .space-panel {
        position: relative;
        top: auto;
        width: 100%;
        max-width: 750px;
        margin-bottom: 20px;
    }
    
    .tables-column {
        width: 100%;
        max-width: 750px;
    }
}

/* Celulares */
@media (max-width: 768px) {
    .inventory-container {
        padding: 20px 10px;
    }
    
    .inventory-layout {
        gap: 15px;
    }
    
    .space-panel {
        padding: 15px;
        min-width: auto;
    }
    
    .space-panel h3 {
        font-size: 1rem;
    }
    
    .space-display {
        font-size: 2rem;
    }
    
    .inventory-table {
        padding: 10px;
    }
    
    .section-header {
        font-size: 1.2rem;
        padding: 8px 10px;
    }
    
    .section-header.small {
        font-size: 0.9rem;
        padding: 6px 5px;
    }
    
    .inventory-table td {
        padding: 8px 10px;
    }
    
    .inventory-table input {
        font-size: 1rem;
    }
    
    .col-espaco,
    .col-arma-espaco,
    .col-arma-dano {
        width: 60px;
    }
    
    .western-nav {
        flex-wrap: wrap;
        gap: 10px;
        padding: 10px;
    }
    
    .western-nav a {
        font-size: 0.85rem;
        padding: 5px 8px;
    }
}

/* Celulares pequenos */
@media (max-width: 480px) {
    .inventory-container {
        padding: 15px 5px;
    }
    
    .space-panel {
        padding: 12px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: 10px;
    }
    
    .space-panel h3 {
        font-size: 0.9rem;
        margin: 0;
        width: auto;
    }
    
    .space-display {
        font-size: 1.6rem;
        margin: 0;
    }
    
    .space-label {
        font-size: 0.75rem;
    }
    
    .space-max {
        margin-top: 0;
    }
    
    .space-max input {
        width: 40px;
        font-size: 1rem;
        padding: 3px;
    }
    
    .inventory-table {
        padding: 5px;
        border-spacing: 2px;
    }
    
    .section-header {
        font-size: 0.9rem;
        padding: 6px 5px;
        letter-spacing: 1px;
    }
    
    .section-header.small {
        font-size: 0.7rem;
        padding: 5px 3px;
    }
    
    .inventory-table td {
        padding: 6px 5px;
    }
    
    .inventory-table input {
        font-size: 0.85rem;
    }
    
    .col-espaco,
    .col-arma-espaco,
    .col-arma-dano {
        width: 45px;
    }
    
    .col-expand {
        width: 30px;
        padding: 3px !important;
    }
    
    .btn-expand {
        width: 24px;
        height: 24px;
        font-size: 0.9rem;
    }
    
    .desc-row textarea {
        min-height: 50px;
        padding: 8px;
        font-size: 0.9rem;
    }
    
    .western-nav a {
        font-size: 0.85rem;
        padding: 5px 8px;
    }
}

</style>
</head>

<body class="locked">

<div class="password-screen" id="password-screen">
    <div class="password-box">
        <h2>üîí Acesso Restrito</h2>
        <p>Digite a senha para acessar esta ficha</p>
        <input type="password" id="password-input" placeholder="Senha..." onkeypress="if(event.key==='Enter') verificarSenha()">
        <button onclick="verificarSenha()">Entrar</button>
        <p class="password-error" id="password-error">Senha incorreta!</p>
    </div>
</div>

<nav class="western-nav">
    <a href="index.html">Ficha</a>
    <a href="habilidades.html">Habilidades</a>
    <a href="montaria.html">Montaria</a>
    <a href="inventario.html" class="active">Invent√°rio</a>
</nav>

<div class="inventory-container">

    <div class="inventory-layout">
        <div class="tables-column">
            <!-- TABELA DE ITENS -->
            <table class="inventory-table" id="items-table">
                <thead>
                    <tr>
                        <td class="section-header" style="width: 40px;"></td>
                        <td class="section-header">ITENS</td>
                        <td class="section-header small">ESPA√áO</td>
                    </tr>
                </thead>
                <tbody id="items-body">
                    <!-- Linhas geradas dinamicamente -->
                </tbody>
            </table>

            <!-- TABELA DE ARMAS -->
            <table class="inventory-table" id="armas-table">
                <thead>
                    <tr>
                        <td class="section-header" style="width: 40px;"></td>
                        <td class="section-header">ARMAS</td>
                        <td class="section-header small">ESPA√áO</td>
                        <td class="section-header small">DANO</td>
                    </tr>
                </thead>
                <tbody id="armas-body">
                    <!-- Linhas geradas dinamicamente -->
                </tbody>
            </table>
        </div>

        <!-- Painel lateral de espa√ßo -->
        <div class="space-panel">
            <h3>CARGA</h3>
            <div class="space-display" id="space-current">0</div>
            <div class="space-label">espa√ßos usados</div>
            <div class="space-max">
                <label>MAX:</label>
                <input type="number" id="space-max" value="10" min="1">
            </div>
            <div class="space-label" id="space-status" style="margin-top: 15px; font-weight: bold;"></div>
        </div>
    </div>

</div>

<script>

// Armazena dados dos itens e armas
let itensData = [];
let armasData = [];
const NUM_ARMAS = 4;

// Toggle descri√ß√£o
function toggleDescricao(btn, descRowId) {
    const descRow = document.getElementById(descRowId);
    descRow.classList.toggle('show');
    btn.classList.toggle('expanded');
    btn.textContent = descRow.classList.contains('show') ? '‚ñ≤' : '‚ñº';
}

// Gera linhas da tabela de itens baseado na carga m√°xima
function gerarLinhasItens() {
    const maxEspaco = parseInt(document.getElementById('space-max').value) || 10;
    const tbody = document.getElementById('items-body');
    
    // Salva dados atuais
    salvarDadosItens();
    
    // Limpa e regenera
    tbody.innerHTML = '';
    
    for (let i = 0; i < maxEspaco; i++) {
        const dadosSalvos = itensData[i] || { nome: '', espaco: '', descricao: '' };
        
        // Linha principal do item
        const tr = document.createElement('tr');
        tr.className = 'item-row';
        tr.innerHTML = `
            <td class="col-expand">
                <button class="btn-expand" onclick="toggleDescricao(this, 'desc-item-${i}')">‚ñº</button>
            </td>
            <td><input type="text" class="item-name" data-index="${i}" placeholder="Nome do item..." value="${escapeHtml(dadosSalvos.nome)}"></td>
            <td class="col-espaco"><input type="number" class="item-space" data-index="${i}" min="0" step="0.5" value="${dadosSalvos.espaco}"></td>
        `;
        tbody.appendChild(tr);
        
        // Linha de descri√ß√£o (oculta por padr√£o)
        const descTr = document.createElement('tr');
        descTr.className = 'desc-row';
        descTr.id = `desc-item-${i}`;
        descTr.innerHTML = `
            <td colspan="3">
                <textarea class="item-desc" data-index="${i}" placeholder="Descri√ß√£o do item, efeitos especiais, origem...">${escapeHtml(dadosSalvos.descricao)}</textarea>
            </td>
        `;
        tbody.appendChild(descTr);
    }
    
    // Adiciona listeners nas novas linhas
    tbody.querySelectorAll('.item-space').forEach(input => {
        input.addEventListener('input', calcularEspaco);
    });
    
    calcularEspaco();
}

// Gera linhas da tabela de armas
function gerarLinhasArmas() {
    const tbody = document.getElementById('armas-body');
    
    // Salva dados atuais
    salvarDadosArmas();
    
    // Limpa e regenera
    tbody.innerHTML = '';
    
    for (let i = 0; i < NUM_ARMAS; i++) {
        const dadosSalvos = armasData[i] || { nome: '', espaco: '', dano: '', descricao: '' };
        
        // Linha principal da arma
        const tr = document.createElement('tr');
        tr.className = 'item-row';
        tr.innerHTML = `
            <td class="col-expand">
                <button class="btn-expand" onclick="toggleDescricao(this, 'desc-arma-${i}')">‚ñº</button>
            </td>
            <td><input type="text" class="arma-name" data-index="${i}" placeholder="Nome da arma..." value="${escapeHtml(dadosSalvos.nome)}"></td>
            <td class="col-arma-espaco"><input type="number" class="item-space arma-space" data-index="${i}" min="0" step="0.5" value="${dadosSalvos.espaco}"></td>
            <td class="col-arma-dano"><input type="text" class="arma-dano" data-index="${i}" placeholder="1 üíÄ" value="${escapeHtml(dadosSalvos.dano)}"></td>
        `;
        tbody.appendChild(tr);
        
        // Linha de descri√ß√£o (oculta por padr√£o)
        const descTr = document.createElement('tr');
        descTr.className = 'desc-row';
        descTr.id = `desc-arma-${i}`;
        descTr.innerHTML = `
            <td colspan="4">
                <textarea class="arma-desc" data-index="${i}" placeholder="Descri√ß√£o da arma, propriedades especiais, muni√ß√£o...">${escapeHtml(dadosSalvos.descricao)}</textarea>
            </td>
        `;
        tbody.appendChild(descTr);
    }
    
    // Adiciona listeners nas armas
    tbody.querySelectorAll('.item-space').forEach(input => {
        input.addEventListener('input', calcularEspaco);
    });
}

// Salva dados dos itens
function salvarDadosItens() {
    const tbody = document.getElementById('items-body');
    const rows = tbody.querySelectorAll('.item-row');
    itensData = [];
    
    rows.forEach((tr, i) => {
        const nomeInput = tr.querySelector('.item-name');
        const espacoInput = tr.querySelector('.item-space');
        const descRow = document.getElementById(`desc-item-${i}`);
        const descInput = descRow ? descRow.querySelector('.item-desc') : null;
        
        itensData[i] = {
            nome: nomeInput ? nomeInput.value : '',
            espaco: espacoInput ? espacoInput.value : '',
            descricao: descInput ? descInput.value : ''
        };
    });
}

// Salva dados das armas
function salvarDadosArmas() {
    const tbody = document.getElementById('armas-body');
    const rows = tbody.querySelectorAll('.item-row');
    armasData = [];
    
    rows.forEach((tr, i) => {
        const nomeInput = tr.querySelector('.arma-name');
        const espacoInput = tr.querySelector('.arma-space');
        const danoInput = tr.querySelector('.arma-dano');
        const descRow = document.getElementById(`desc-arma-${i}`);
        const descInput = descRow ? descRow.querySelector('.arma-desc') : null;
        
        armasData[i] = {
            nome: nomeInput ? nomeInput.value : '',
            espaco: espacoInput ? espacoInput.value : '',
            dano: danoInput ? danoInput.value : '',
            descricao: descInput ? descInput.value : ''
        };
    });
}

// Escape HTML para evitar XSS
function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// Calcula espa√ßo total usado
function calcularEspaco() {
    const espacos = document.querySelectorAll('.item-space');
    let total = 0;
    
    espacos.forEach(input => {
        const valor = parseInt(input.value) || 0;
        total += valor;
    });
    
    const maxEspaco = parseInt(document.getElementById('space-max').value) || 10;
    const displayEl = document.getElementById('space-current');
    const statusEl = document.getElementById('space-status');
    
    displayEl.textContent = total;
    
    if (total > maxEspaco) {
        displayEl.classList.add('over');
        statusEl.textContent = `‚ö†Ô∏è +${total - maxEspaco} acima!`;
        statusEl.style.color = '#ff4444';
    } else {
        displayEl.classList.remove('over');
        statusEl.textContent = `‚úì ${maxEspaco - total} livres`;
        statusEl.style.color = '#88ff88';
    }
}

// Listener para mudar carga m√°xima
document.getElementById('space-max').addEventListener('input', gerarLinhasItens);

// Inicializa√ß√£o
gerarLinhasItens();
gerarLinhasArmas();
</script>

<script>
    // Script para manter o ?nome=Fulano nos links do menu
    (function() {
        const urlParams = new URLSearchParams(window.location.search);
        const nomeParam = urlParams.get('nome');

        if (nomeParam) {
            document.querySelectorAll('.western-nav a').forEach(link => {
                const hrefOriginal = link.getAttribute('href');
                if (!hrefOriginal.includes('?nome=')) {
                    link.setAttribute('href', `${hrefOriginal}?nome=${nomeParam}`);
                }
            });
        }
    })();
</script>

</body>
</html>
